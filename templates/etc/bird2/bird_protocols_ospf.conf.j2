# ansible managed
{% for ospf in birdprotocols['ospf'] | default({}) | dict2items %}
# {{ ospf }}
protocol ospf {{ ospf['version'] | default('v2') }} ospf_{{ ospf['version'] | default('v2') }}_{{ ospf.key }} {
{%   if ospf['version'] | default('v2') == "v2" %}
  ipv4 {
    import {{ ospf.value.import_filter | default('all') }};
    export {{ ospf.value.export_filter | default('all') }};
{%   if ospf.value.preference is defined %}
    preference {{ ospf.value.preference }};
{%   endif %}
{%   if ospf.value.table is defined %}
    table {{ ospf.value.table }};
{%   endif %}
  };
{%   endif %}
{%   if ospf['version'] | default('v2') == "v3" %}
  ipv4 {
    import {{ ospf.value.import_filter | default('all') }};
    export {{ ospf.value.export_filter | default('all') }};
{%   if ospf.value.preference is defined %}
    preference {{ ospf.value.preference }};
{%   endif %}
{%   if ospf.value.table is defined %}
    table {{ ospf.value.table }};
{%   endif %}
  };
  ipv6 {
    import {{ ospf.value.import_filter6 | default('all') }};
    export {{ ospf.value.export_filter6 | default('all') }};
{%   if ospf.value.preference6 is defined or ospf.value.preference is defined %}
    preference {{ ospf.value.preference6 | default(ospf.value.preference) }};
{%   endif %}
{%   if ospf.value.table6 is defined or ospf.value.table is defined %}
    table {{ ospf.value.table6 | default(ospf.value.table) }};
{%   endif %}
  };
{%   endif %}
  rfc1583compat no;
  stub router no;
  tick 1;
  ecmp no;
{%   for area in ospf.value.area | default({}) | dict2items %}
  # {{ area }}
  area {{ area.key }} {
    external {
      0.0.0.0/0;
    };
{%     for iface in area.value.interface | default({}) | dict2items %}
    interface "{{ iface.key }}" {
      {% if iface.value.cost is defined %}cost {{ iface.value.cost }}{% else %}cost 200{% endif %};
      hello 10;
      poll 20;
      retransmit 5;
      priority 10;
      wait 40;
      type bcast;
{%     if iface.value.authentication is defined %}      authentication  {{ iface.value.authentication }};{% endif %}
{%     if iface.value.password is defined %}      password  "{{ iface.value.password }}";{% endif %}
    };
{%     endfor %}
  };
{%   endfor %}
};
{% endfor %}
